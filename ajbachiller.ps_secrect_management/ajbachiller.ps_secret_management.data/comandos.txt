-- Fijar el entorno de ejecución. Si no se define se ejecuta como Develop
$env:ASPNETCORE_ENVIRONMENT='Local'

-- Instalar ef si no está ya instalado.
dotnet tool install --global dotnet-ef --version 6.*

-- Para habilitar las migraciones (primera ejecución). Como la BBDD ya existe eliminaremos manualmente el código del método Up de la primera migración
dotnet ef migrations add Startup --context PSContext --startup-project ajbachiller.ps_secret_management --project ajbachiller.ps_secret_management.data

-- Para crear una nueva migración ejecutamos lo siguiente cambiando $NOMBRE por el que queramos.
dotnet ef migrations add "$NOMBRE" --context ContenedoresDatabaseContext --startup-project Enresa.Contenedores.WebApi --project Enresa.Contenedores.Infrastructure

-- Para ver que script aplicara en un entorno determinado
dotnet ef migrations script --context ContenedoresDatabaseContext --startup-project Enresa.Contenedores.WebApi --project Enresa.Contenedores.Infrastructure

-- ingenieria reversa (Sobreescribe código, ir con ojo)
dotnet ef dbcontext scaffold "Data Source=11LAPBRJK4j3;Initial Catalog=SGR;Integrated Security=True" Microsoft.EntityFrameworkCore.SqlServer --force --context ContenedoresDatabaseContext --project Enresa.Contenedores.Infrastructure --table Constantes --table CabeceraPlanificacionAnualFc --table PlanificacionAnualFabricacion

-- Elimina la ultima migracion
dotnet ef migrations remove --context ContenedoresDatabaseContext --startup-project Enresa.Contenedores.WebApi --project Enresa.Contenedores.Infrastructure

-- Aplica los cambios
dotnet ef database update --context ContenedoresDatabaseContext --startup-project Enresa.Contenedores.WebApi --project Enresa.Contenedores.Infrastructure
